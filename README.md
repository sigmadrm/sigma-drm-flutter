# sigma-drm-flutter

`sigma-drm-flutter` is a **high-performance Flutter plugin** for integrating **SigmaDRM** into Flutter applications.  
It enables secure DRM video playback with **automated Fingerprint and Message overlays**, optimized for **Android Mobile** and **Android TV** platforms.

The plugin is built on top of Flutter‚Äôs `video_player` and is designed for **OTT / IPTV / Streaming** applications.

---

## ‚ú® Features

- üîê **SigmaDRM Integration**  
  Secure DRM protection for video content using SigmaDRM.

- üñº **Fingerprint & Message Overlay (FPM)**

- üéõ **Customizable Video Controls**  
  Integrated with `video_player_control_panel` for flexible UI customization, or use `chewie` for Material and Cupertino-styled video controls.

- üöÄ **High Performance**  
  Optimized for large-scale streaming apps and Android TV devices.

---

## üì¶ Installation

Add `sigma_video_player` to your `pubspec.yaml`:

```yaml
dependencies:
  sigma_video_player:
    git:
      url: https://github.com/sigmadrm/sigma-drm-flutter.git
      ref: v1.0.0 # Replace with the latest version
```

Install dependencies:

```bash
flutter pub get
```

---

## üì± Platform Support

| Platform       | Status                          |
| -------------- | ------------------------------- |
| Android Mobile | ‚úÖ Supported                    |
| Android Tablet | ‚úÖ Supported                    |
| Android TV     | ‚úÖ Supported (TV Box, Smart TV) |

---

## üöÄ Usage Guide

### 1Ô∏è‚É£ Initialize SigmaVideoPlayer

The plugin **must be initialized before running the application**.

```dart
import 'package:flutter/widgets.dart';
import 'package:sigma_video_player/sigma_video_player.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  SigmaVideoPlayer.init();

  runApp(const MyApp());
}
```

---

### 2Ô∏è‚É£ Configure Fingerprint & Message (FPM)

Configure the global Fingerprint & Message module.

```dart
SigmaFPM.instance.setConfig(
  accessToken: 'YOUR_JWT_ACCESS_TOKEN',
);

// Start fetching configuration from SigmaDRM API
SigmaFPM.instance.start();
```

---

### 3Ô∏è‚É£ Wrap Application UI with Overlay

To ensure Fingerprint and Message overlays persist correctly (especially in **fullscreen mode**), you should wrap your `MaterialApp` using the `builder` property. This places the overlay above the Navigator.

```dart
@override
Widget build(BuildContext context) {
  return MaterialApp(
    // ... other properties
    builder: (context, child) {
      return SigmaFPM.instance.buildOverlay(
        child: child ?? const SizedBox(),
      );
    },
    home: const MyApp(),
  );
}
```

---

### 4Ô∏è‚É£ DRM Video Playback

Create a `VideoPlayerController` with DRM configuration.

```dart
final controller = VideoPlayerController.networkUrl(
  Uri.parse('https://your-stream-url.mpd'),
  drmConfiguration: {
    'merchantId': 'YOUR_MERCHANT_ID',
    'appId': 'YOUR_APP_ID',
    'userId': 'YOUR_USER_ID',
    'sessionId': 'YOUR_SESSION_ID',
  },
);

await controller.initialize();
controller.play();
```

---

### 5Ô∏è‚É£ Update Channel ID When Switching Content

```dart
SigmaFPM.instance.setChannelId('YOUR_CHANNEL_ID');
```

---

### 6Ô∏è‚É£ Update Access Token Dynamically

If your application refreshes the authentication token during a session, you can update it without restarting the module.

```dart
SigmaFPM.instance.setAccessToken('YOUR_JWT_ACCESS_TOKEN');
```

---

## üîß Configuration Parameters

| Placeholder             | Description                                                                          |
| ----------------------- | ------------------------------------------------------------------------------------ |
| `YOUR_JWT_ACCESS_TOKEN` | JWT token used to authenticate the user with SigmaDRM                                |
| `YOUR_MERCHANT_ID`      | Merchant ID provided by SigmaDRM                                                     |
| `YOUR_APP_ID`           | Application ID provided by SigmaDRM                                                  |
| `YOUR_USER_ID`          | Current user identifier                                                              |
| `YOUR_SESSION_ID`       | Session ID for SigmaDRM license authentication                                       |
| `YOUR_CHANNEL_ID`       | A unique identifier for the current channel or content, generated by the SMS system. |

---

## ‚ñ∂Ô∏è Run the Example Application

```bash
cd example
flutter pub get
flutter run
```

---

## üìö Reference

- [video_player](https://pub.dev/packages/video_player): Official Flutter plugin for cross-platform video playback, used as the base player in this project.
- [chewie](https://pub.dev/packages/chewie): A video player for Flutter with Material and Cupertino skins, providing customizable UI controls for video playback.
- [video_player_control_panel](https://pub.dev/packages/video_player_control_panel): A flexible and customizable control panel for Flutter video players, offering granular control over UI elements.
